function buildPrivatePub(doc){var self={connecting:!1,fayeClient:null,fayeCallbacks:[],subscriptions:{},subscriptionCallbacks:{},faye:function(t){if(self.fayeClient)t(self.fayeClient);else if(self.fayeCallbacks.push(t),self.subscriptions.server&&!self.connecting){self.connecting=!0;var e=doc.createElement("script");e.type="text/javascript",e.src=self.subscriptions.server+".js",e.onload=self.connectToFaye,doc.documentElement.appendChild(e)}},connectToFaye:function(){self.fayeClient=new Faye.Client(self.subscriptions.server),self.fayeClient.addExtension(self.fayeExtension);for(var t=0;t<self.fayeCallbacks.length;t++)self.fayeCallbacks[t](self.fayeClient)},fayeExtension:{outgoing:function(t,e){if("/meta/subscribe"==t.channel){var n=self.subscriptions[t.subscription];t.ext||(t.ext={}),t.ext.private_pub_signature=n.signature,t.ext.private_pub_timestamp=n.timestamp}e(t)}},sign:function(t){self.subscriptions.server||(self.subscriptions.server=t.server),self.subscriptions[t.channel]=t,self.faye(function(e){e.subscribe(t.channel,self.handleResponse)})},handleResponse:function(message){message.eval&&eval(message.eval),(callback=self.subscriptionCallbacks[message.channel])&&callback(message.data,message.channel)},subscribe:function(t,e){self.subscriptionCallbacks[t]=e}};return self}!function(t,e){t.rails!==e&&t.error("jquery-ujs has already been loaded!");var n,i=t(document);t.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(e){var n=t('meta[name="csrf-token"]').attr("content");n&&e.setRequestHeader("X-CSRF-Token",n)},refreshCSRFTokens:function(){var e=t("meta[name=csrf-token]").attr("content"),n=t("meta[name=csrf-param]").attr("content");t('form input[name="'+n+'"]').val(e)},fire:function(e,n,i){var s=t.Event(n);return e.trigger(s,i),s.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t.attr("href")},handleRemote:function(i){var s,a,o,r,c,l,u,h;if(n.fire(i,"ajax:before")){if(r=i.data("cross-domain"),c=r===e?null:r,l=i.data("with-credentials")||null,u=i.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,i.is("form")){s=i.attr("method"),a=i.attr("action"),o=i.serializeArray();var d=i.data("ujs:submit-button");d&&(o.push(d),i.data("ujs:submit-button",null))}else i.is(n.inputChangeSelector)?(s=i.data("method"),a=i.data("url"),o=i.serialize(),i.data("params")&&(o=o+"&"+i.data("params"))):i.is(n.buttonClickSelector)?(s=i.data("method")||"get",a=i.data("url"),o=i.serialize(),i.data("params")&&(o=o+"&"+i.data("params"))):(s=i.data("method"),a=n.href(i),o=i.data("params")||null);return h={type:s||"GET",data:o,dataType:u,beforeSend:function(t,s){return s.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+s.accepts.script),n.fire(i,"ajax:beforeSend",[t,s])?void i.trigger("ajax:send",t):!1},success:function(t,e,n){i.trigger("ajax:success",[t,e,n])},complete:function(t,e){i.trigger("ajax:complete",[t,e])},error:function(t,e,n){i.trigger("ajax:error",[t,e,n])},crossDomain:c},l&&(h.xhrFields={withCredentials:l}),a&&(h.url=a),n.ajax(h)}return!1},handleMethod:function(i){var s=n.href(i),a=i.data("method"),o=i.attr("target"),r=t("meta[name=csrf-token]").attr("content"),c=t("meta[name=csrf-param]").attr("content"),l=t('<form method="post" action="'+s+'"></form>'),u='<input name="_method" value="'+a+'" type="hidden" />';c!==e&&r!==e&&(u+='<input name="'+c+'" value="'+r+'" type="hidden" />'),o&&l.attr("target",o),l.hide().append(u).appendTo("body"),l.submit()},formElements:function(e,n){return e.is("form")?t(e[0].elements).filter(n):e.find(n)},disableFormElements:function(e){n.formElements(e,n.disableSelector).each(function(){n.disableFormElement(t(this))})},disableFormElement:function(t){var n,i;n=t.is("button")?"html":"val",i=t.data("disable-with"),t.data("ujs:enable-with",t[n]()),i!==e&&t[n](i),t.prop("disabled",!0)},enableFormElements:function(e){n.formElements(e,n.enableSelector).each(function(){n.enableFormElement(t(this))})},enableFormElement:function(t){var e=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.prop("disabled",!1)},allowAction:function(t){var e,i=t.data("confirm"),s=!1;return i?(n.fire(t,"confirm")&&(s=n.confirm(i),e=n.fire(t,"confirm:complete",[s])),s&&e):!0},blankInputs:function(e,n,i){var s,a,o=t(),r=n||"input,textarea",c=e.find(r);return c.each(function(){if(s=t(this),a=s.is("input[type=checkbox],input[type=radio]")?s.is(":checked"):s.val(),!a==!i){if(s.is("input[type=radio]")&&c.filter('input[type=radio]:checked[name="'+s.attr("name")+'"]').length)return!0;o=o.add(s)}}),o.length?o:!1},nonBlankInputs:function(t,e){return n.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var i=t.data("disable-with");t.data("ujs:enable-with",t.html()),i!==e&&t.html(i),t.bind("click.railsDisable",function(t){return n.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},n.fire(i,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,i){t.crossDomain||n.CSRFProtection(i)}),i.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(t(this))}),i.delegate(n.buttonDisableSelector,"ajax:complete",function(){n.enableFormElement(t(this))}),i.delegate(n.linkClickSelector,"click.rails",function(i){var s=t(this),a=s.data("method"),o=s.data("params"),r=i.metaKey||i.ctrlKey;if(!n.allowAction(s))return n.stopEverything(i);if(!r&&s.is(n.linkDisableSelector)&&n.disableElement(s),s.data("remote")!==e){if(r&&(!a||"GET"===a)&&!o)return!0;var c=n.handleRemote(s);return c===!1?n.enableElement(s):c.error(function(){n.enableElement(s)}),!1}return s.data("method")?(n.handleMethod(s),!1):void 0}),i.delegate(n.buttonClickSelector,"click.rails",function(e){var i=t(this);if(!n.allowAction(i))return n.stopEverything(e);i.is(n.buttonDisableSelector)&&n.disableFormElement(i);var s=n.handleRemote(i);return s===!1?n.enableFormElement(i):s.error(function(){n.enableFormElement(i)}),!1}),i.delegate(n.inputChangeSelector,"change.rails",function(e){var i=t(this);return n.allowAction(i)?(n.handleRemote(i),!1):n.stopEverything(e)}),i.delegate(n.formSubmitSelector,"submit.rails",function(i){var s,a,o=t(this),r=o.data("remote")!==e;if(!n.allowAction(o))return n.stopEverything(i);if(o.attr("novalidate")==e&&(s=n.blankInputs(o,n.requiredInputSelector),s&&n.fire(o,"ajax:aborted:required",[s])))return n.stopEverything(i);if(r){if(a=n.nonBlankInputs(o,n.fileInputSelector)){setTimeout(function(){n.disableFormElements(o)},13);var c=n.fire(o,"ajax:aborted:file",[a]);return c||setTimeout(function(){n.enableFormElements(o)},13),c}return n.handleRemote(o),!1}setTimeout(function(){n.disableFormElements(o)},13)}),i.delegate(n.formInputClickSelector,"click.rails",function(e){var i=t(this);if(!n.allowAction(i))return n.stopEverything(e);var s=i.attr("name"),a=s?{name:s,value:i.val()}:null;i.closest("form").data("ujs:submit-button",a)}),i.delegate(n.formSubmitSelector,"ajax:send.rails",function(e){this==e.target&&n.disableFormElements(t(this))}),i.delegate(n.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&n.enableFormElements(t(this))}),t(function(){n.refreshCSRFTokens()}))}(jQuery),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.WebSocketRails=function(){function e(e,n){this.url=e,this.use_websockets=null!=n?n:!0,this.connection_stale=t(this.connection_stale,this),this.pong=t(this.pong,this),this.supports_websockets=t(this.supports_websockets,this),this.dispatch_channel=t(this.dispatch_channel,this),this.unsubscribe=t(this.unsubscribe,this),this.subscribe_private=t(this.subscribe_private,this),this.subscribe=t(this.subscribe,this),this.dispatch=t(this.dispatch,this),this.trigger_event=t(this.trigger_event,this),this.trigger=t(this.trigger,this),this.bind=t(this.bind,this),this.connection_established=t(this.connection_established,this),this.new_message=t(this.new_message,this),this.reconnect=t(this.reconnect,this),this.callbacks={},this.channels={},this.queue={},this.connect()}return e.prototype.connect=function(){return this.state="connecting",this._conn=this.supports_websockets()&&this.use_websockets?new e.WebSocketConnection(this.url,this):new e.HttpConnection(this.url,this),this._conn.new_message=this.new_message},e.prototype.disconnect=function(){return this._conn&&(this._conn.close(),delete this._conn._conn,delete this._conn),this.state="disconnected"},e.prototype.reconnect=function(){var t,e,n,i,s;n=null!=(i=this._conn)?i.connection_id:void 0,this.disconnect(),this.connect(),s=this.queue;for(e in s)t=s[e],t.connection_id!==n||t.is_result()||this.trigger_event(t);return this.reconnect_channels()},e.prototype.new_message=function(t){var n,i,s,a,o,r;for(o=[],i=0,s=t.length;s>i;i++)r=t[i],n=new e.Event(r),n.is_result()?(null!=(a=this.queue[n.id])&&a.run_callbacks(n.success,n.data),delete this.queue[n.id]):n.is_channel()?this.dispatch_channel(n):n.is_ping()?this.pong():this.dispatch(n),o.push("connecting"===this.state&&"client_connected"===n.name?this.connection_established(n.data):void 0);return o},e.prototype.connection_established=function(t){return this.state="connected",this._conn.setConnectionId(t.connection_id),this._conn.flush_queue(),null!=this.on_open?this.on_open(t):void 0},e.prototype.bind=function(t,e){var n;return null==(n=this.callbacks)[t]&&(n[t]=[]),this.callbacks[t].push(e)},e.prototype.trigger=function(t,n,i,s){var a,o;return a=new e.Event([t,n,null!=(o=this._conn)?o.connection_id:void 0],i,s),this.trigger_event(a)},e.prototype.trigger_event=function(t){var e,n;return null==(e=this.queue)[n=t.id]&&(e[n]=t),this._conn&&this._conn.trigger(t),t},e.prototype.dispatch=function(t){var e,n,i,s,a;if(null!=this.callbacks[t.name]){for(s=this.callbacks[t.name],a=[],n=0,i=s.length;i>n;n++)e=s[n],a.push(e(t.data));return a}},e.prototype.subscribe=function(t,n,i){var s;return null==this.channels[t]?(s=new e.Channel(t,this,!1,n,i),this.channels[t]=s,s):this.channels[t]},e.prototype.subscribe_private=function(t,n,i){var s;return null==this.channels[t]?(s=new e.Channel(t,this,!0,n,i),this.channels[t]=s,s):this.channels[t]},e.prototype.unsubscribe=function(t){return null!=this.channels[t]?(this.channels[t].destroy(),delete this.channels[t]):void 0},e.prototype.dispatch_channel=function(t){return null!=this.channels[t.channel]?this.channels[t.channel].dispatch(t.name,t.data):void 0},e.prototype.supports_websockets=function(){return"function"==typeof WebSocket||"object"==typeof WebSocket},e.prototype.pong=function(){var t,n;return t=new e.Event(["websocket_rails.pong",{},null!=(n=this._conn)?n.connection_id:void 0]),this._conn.trigger(t)},e.prototype.connection_stale=function(){return"connected"!==this.state},e.prototype.reconnect_channels=function(){var t,e,n,i,s;i=this.channels,s=[];for(n in i)e=i[n],t=e._callbacks,e.destroy(),delete this.channels[n],e=e.is_private?this.subscribe_private(n):this.subscribe(n),e._callbacks=t,s.push(e);return s},e}()}.call(this),function(){WebSocketRails.Event=function(){function t(t,e,n){var i;this.success_callback=e,this.failure_callback=n,this.name=t[0],i=t[1],null!=i&&(this.id=null!=i.id?i.id:65536*(1+Math.random())|0,this.channel=null!=i.channel?i.channel:void 0,this.data=null!=i.data?i.data:i,this.token=null!=i.token?i.token:void 0,this.connection_id=t[2],null!=i.success&&(this.result=!0,this.success=i.success))}return t.prototype.is_channel=function(){return null!=this.channel},t.prototype.is_result=function(){return"undefined"!=typeof this.result},t.prototype.is_ping=function(){return"websocket_rails.ping"===this.name},t.prototype.serialize=function(){return JSON.stringify([this.name,this.attributes()])},t.prototype.attributes=function(){return{id:this.id,channel:this.channel,data:this.data,token:this.token}},t.prototype.run_callbacks=function(t,e){return this.success=t,this.result=e,this.success===!0?"function"==typeof this.success_callback?this.success_callback(this.result):void 0:"function"==typeof this.failure_callback?this.failure_callback(this.result):void 0},t}()}.call(this),function(){WebSocketRails.AbstractConnection=function(){function t(t,e){this.dispatcher=e,this.message_queue=[]}return t.prototype.close=function(){},t.prototype.trigger=function(t){return"connected"!==this.dispatcher.state?this.message_queue.push(t):this.send_event(t)},t.prototype.send_event=function(t){return null!=this.connection_id?t.connection_id=this.connection_id:void 0},t.prototype.on_close=function(t){var e;return this.dispatcher&&this.dispatcher._conn===this?(e=new WebSocketRails.Event(["connection_closed",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(e)):void 0},t.prototype.on_error=function(t){var e;return this.dispatcher&&this.dispatcher._conn===this?(e=new WebSocketRails.Event(["connection_error",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(e)):void 0},t.prototype.on_message=function(t){return this.dispatcher&&this.dispatcher._conn===this?this.dispatcher.new_message(t):void 0},t.prototype.setConnectionId=function(t){this.connection_id=t},t.prototype.flush_queue=function(){var t,e,n,i;for(i=this.message_queue,e=0,n=i.length;n>e;e++)t=i[e],this.trigger(t);return this.message_queue=[]},t}()}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var s in n)e.call(n,s)&&(t[s]=n[s]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;WebSocketRails.HttpConnection=function(e){function n(t,e){var i;this.dispatcher=e,n.__super__.constructor.apply(this,arguments),this._url="http://"+t,this._conn=this._createXMLHttpObject(),this.last_pos=0;try{this._conn.onreadystatechange=function(t){return function(){return t._parse_stream()}}(this),this._conn.addEventListener("load",this.on_close,!1)}catch(s){i=s,this._conn.onprogress=function(t){return function(){return t._parse_stream()}}(this),this._conn.onload=this.on_close,this._conn.readyState=3}this._conn.open("GET",this._url,!0),this._conn.send()}return t(n,e),n.prototype.connection_type="http",n.prototype._httpFactories=function(){return[function(){return new XDomainRequest},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}]},n.prototype.close=function(){return this._conn.abort()},n.prototype.send_event=function(t){return n.__super__.send_event.apply(this,arguments),this._post_data(t.serialize())},n.prototype._post_data=function(t){return $.ajax(this._url,{type:"POST",data:{client_id:this.connection_id,data:t},success:function(){}})},n.prototype._createXMLHttpObject=function(){var t,e,n,i,s,a;for(a=!1,e=this._httpFactories(),i=0,s=e.length;s>i;i++){n=e[i];try{a=n()}catch(o){t=o;continue}break}return a},n.prototype._parse_stream=function(){var t,e,n;if(3===this._conn.readyState){t=this._conn.responseText.substring(this.last_pos),this.last_pos=this._conn.responseText.length,t=t.replace(/\]\]\[\[/g,"],[");try{return n=JSON.parse(t),this.on_message(n)}catch(i){e=i}}},n}(WebSocketRails.AbstractConnection)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var s in n)e.call(n,s)&&(t[s]=n[s]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;WebSocketRails.WebSocketConnection=function(e){function n(t,e){this.url=t,this.dispatcher=e,n.__super__.constructor.apply(this,arguments),this.url.match(/^wss?:\/\//)?console.log("WARNING: Using connection urls with protocol specified is depricated"):this.url="https:"===window.location.protocol?"wss://"+this.url:"ws://"+this.url,this._conn=new WebSocket(this.url),this._conn.onmessage=function(t){return function(e){var n;return n=JSON.parse(e.data),t.on_message(n)}}(this),this._conn.onclose=function(t){return function(e){return t.on_close(e)}}(this),this._conn.onerror=function(t){return function(e){return t.on_error(e)}}(this)}return t(n,e),n.prototype.connection_type="websocket",n.prototype.close=function(){return this._conn.close()},n.prototype.send_event=function(t){return n.__super__.send_event.apply(this,arguments),this._conn.send(t.serialize())},n}(WebSocketRails.AbstractConnection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};WebSocketRails.Channel=function(){function e(e,n,i,s,a){var o,r,c;this.name=e,this._dispatcher=n,this.is_private=null!=i?i:!1,this.on_success=s,this.on_failure=a,this._failure_launcher=t(this._failure_launcher,this),this._success_launcher=t(this._success_launcher,this),this._callbacks={},this._token=void 0,this._queue=[],r=this.is_private?"websocket_rails.subscribe_private":"websocket_rails.subscribe",this.connection_id=null!=(c=this._dispatcher._conn)?c.connection_id:void 0,o=new WebSocketRails.Event([r,{data:{channel:this.name}},this.connection_id],this._success_launcher,this._failure_launcher),this._dispatcher.trigger_event(o)}return e.prototype.destroy=function(){var t,e,n;return this.connection_id===(null!=(n=this._dispatcher._conn)?n.connection_id:void 0)&&(e="websocket_rails.unsubscribe",t=new WebSocketRails.Event([e,{data:{channel:this.name}},this.connection_id]),this._dispatcher.trigger_event(t)),this._callbacks={}},e.prototype.bind=function(t,e){var n;return null==(n=this._callbacks)[t]&&(n[t]=[]),this._callbacks[t].push(e)},e.prototype.trigger=function(t,e){var n;return n=new WebSocketRails.Event([t,{channel:this.name,data:e,token:this._token},this.connection_id]),this._token?this._dispatcher.trigger_event(n):this._queue.push(n)},e.prototype.dispatch=function(t,e){var n,i,s,a,o,r;if("websocket_rails.channel_token"===t)return this.connection_id=null!=(a=this._dispatcher._conn)?a.connection_id:void 0,this._token=e.token,this.flush_queue();if(null!=this._callbacks[t]){for(o=this._callbacks[t],r=[],i=0,s=o.length;s>i;i++)n=o[i],r.push(n(e));return r}},e.prototype._success_launcher=function(t){return null!=this.on_success?this.on_success(t):void 0},e.prototype._failure_launcher=function(t){return null!=this.on_failure?this.on_failure(t):void 0},e.prototype.flush_queue=function(){var t,e,n,i;for(i=this._queue,e=0,n=i.length;n>e;e++)t=i[e],this._dispatcher.trigger_event(t);return this._queue=[]},e}()}.call(this);var PrivatePub=buildPrivatePub(document);